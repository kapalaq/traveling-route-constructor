{% extends "base.html" %}

{% block title %}Home - Budget App{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Summary Section -->
    <div class="summary-section">
        <div class="wallet-selector">
            <select id="currentWalletSelect" onchange="switchWallet(this.value)">
                {% for wallet in wallets %}
                <option value="{{ wallet.id }}" {% if loop.first %}selected{% endif %}>
                    {{ wallet.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="balance-card">
            <div class="balance-label">Current Balance</div>
            <div class="balance-amount" id="currentBalance">0 ₸</div>
        </div>
        
        <div class="summary-stats" id="summaryStats">
            <div class="stat-card stat-income">
                <div class="stat-label">Income</div>
                <div class="stat-value" id="totalIncome">0 ₸</div>
            </div>
            <div class="stat-card stat-expense">
                <div class="stat-label">Expenses</div>
                <div class="stat-value" id="totalExpense">0 ₸</div>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
        <div class="filter-group">
            <label>Period</label>
            <select id="periodFilter" onchange="applyFilters()">
                <option value="all">All Time</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month" selected>This Month</option>
                <option value="year">This Year</option>
                <option value="custom">Custom Range</option>
            </select>
        </div>
        <div class="filter-group" id="customDateRange" style="display: none;">
            <input type="date" id="startDate" onchange="applyFilters()">
            <span>to</span>
            <input type="date" id="endDate" onchange="applyFilters()">
        </div>
        <div class="filter-group">
            <label>Category</label>
            <select id="categoryFilter" onchange="applyFilters()">
                <option value="all">All Categories</option>
                <option value="salary">Salary</option>
                <option value="food">Food</option>
                <option value="healthcare">Healthcare</option>
                <option value="home">Home</option>
                <option value="education">Education</option>
                <option value="subscriptions">Subscriptions</option>
                <option value="entertainment">Entertainment</option>
                <option value="restaurants">Restaurants</option>
                <option value="transport">Transport</option>
                <option value="shopping">Shopping</option>
                <option value="other">Other</option>
            </select>
        </div>
    </div>

    <!-- Category Breakdown -->
    <div class="category-breakdown" id="categoryBreakdown">
        <!-- Will be populated dynamically -->
    </div>

    <!-- Operations List -->
    <div class="operations-section">
        <h2>Recent Operations</h2>
        <div class="operations-list" id="operationsList">
            <div class="loading">Loading operations...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let currentWalletId = {% if wallets %}{{ wallets[0].id }}{% else %}null{% endif %};
    let allWallets = {{ wallets | tojson | safe }};

    // Debug: Log the initial data
    console.log('Current Wallet ID:', currentWalletId);
    console.log('All Wallets:', allWallets);
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadWallets();
        if (currentWalletId) {
            switchWallet(currentWalletId);
        }
        
        // Set current date/time as default for operation form
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('operationTime').value = now.toISOString().slice(0, 16);
    });
</script>
{% endblock %}